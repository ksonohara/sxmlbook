/*
 * mikan.js JavaScript Web Library
 *  JavaScript Module
 *
 * Copyright (C) 2008-15 K.Sonohara
 * Code released under [Mozilla Public License, version 2.0](https://github.com/ksonohara/mikan_js/blob/master/LICENSE)
 *
 * https://github.com/ksonohara/mikan_js/
 * http://www.expertsoftware-i.com/
 *
 */
var MIKAN_JS_MIN = true;
if(void 0==MIKAN_JS_ON)var MIKAN_JS_ON=!1;if(void 0==MIKAN_JS_MIN)var MIKAN_JS_MIN=!1;if(void 0==MIKAN_DEBUG_ON)var MIKAN_DEBUG_ON=!0;if(void 0==MIKAN_WSGI_ROOT)var MIKAN_WSGI_ROOT="";if(void 0==MIKAN_HTDOCS_ROOT)var MIKAN_HTDOCS_ROOT="./";if(void 0==MIKAN_JS_ROOT)var MIKAN_JS_ROOT=MIKAN_HTDOCS_ROOT+"js/";if(void 0==MIKAN_IMAGE_ROOT)var MIKAN_IMAGE_ROOT=MIKAN_HTDOCS_ROOT+"images/";if(void 0==MIKAN_JS_MIKAN)var MIKAN_JS_MIKAN=MIKAN_JS_ROOT+"mikan/";if(void 0==MIKAN_LANG)try{var MIKAN_LANG=(navigator.userLanguage||navigator.browserLanguage||navigator.language).substr(0,2)}catch(e){var MIKAN_LANG="ja"}if(0==MIKAN_JS_ON){var MIKAN_JS_MIKAN_FILES=[];if(MIKAN_JS_MIN||(MIKAN_JS_MIKAN_FILES=["mikan.const.js","mikan.resource.js","mikan.util.js","mikan.html.js","mikan.css.js","mikan.dialog.js","mikan.page.js","mikan.form.js","mikan.json.js","mikan.tree.js","mikan.admin.js"]),MIKAN_JS_MIKAN_FILES.push("i18n/"+MIKAN_LANG+"/mikan.resource.js"),void 0==MIKAN_JS_FILES)var MIKAN_JS_FILES=[];var mikan={};mikan.resource={}}if(mikan.log=function(a){try{console.log(a)}catch(b){try{console.log(a)}catch(b){}}},mikan.log_debug=function(a){if(MIKAN_DEBUG_ON){try{console.debug(a)}catch(b){try{console.log(a)}catch(b){}}try{console.trace()}catch(b){}}},mikan.log_error=function(a){try{console.error(a)}catch(b){try{console.log(a)}catch(b){}}try{console.trace()}catch(b){}},mikan.js_load=function(a,b,d){c=d,null!=d&&(c="utf-8"),document.write('<script type="text/javascript" src="'+a+b+'" charset="'+c+'">;</script>')},mikan.jss_load=function(a,b,d){c=d,null!=d&&(c="utf-8");for(var e in b)mikan.js_load(a,b[e],c)},0==MIKAN_JS_ON&&void 0!=MIKAN_JS_ROOT)try{mikan.jss_load(MIKAN_JS_MIKAN,MIKAN_JS_MIKAN_FILES,"utf-8"),mikan.jss_load(MIKAN_JS_ROOT,MIKAN_JS_FILES,"utf-8"),MIKAN_JS_ON=!0}catch(e){MIKAN_JS_ON=!1}var MIKAN_TAG_LT="<",MIKAN_TAG_GT=">",MIKAN_TAG_QUOT='"',TAG_LT=MIKAN_TAG_LT,TAG_GT=MIKAN_TAG_GT,TAG_QUOT=MIKAN_TAG_QUOT;MIKAN_JS_ON=!0,mikan.consts={};mikan.resource.form={},mikan.resource.message={},mikan.resource.form.messages={},mikan.resource.OK="OK",mikan.resource.CANCEL="Cancel",mikan.resource.CLOSE="Close",mikan.resource.YES="Yes",mikan.resource.NO="No",mikan.resource.ERROR="Error",mikan.resource.CONFIRM="Confirm",mikan.resource.SUBMIT="Submit",mikan.resource.LOADING="Loading..",mikan.resource.DONE="Done",mikan.resource.PROCESS="Process",mikan.resource.PROCESSING="Processing..",mikan.resource.REQUIRED="[Required]",mikan.resource.message.DONE="Process done.",mikan.resource.form.messages.REQUIRED="Do rrequired.",mikan.resource.form.messages.NUMBER="Number only.",mikan.resource.form.messages.MATCH="is not matched.",mikan.resource.form.messages.REG="No input format.",mikan.resource.form.messages.NOSELECT="Need selected.",mikan.resource.form.messages.NOTFOUNTZIPCODE="Not Found ZipCode.";mikan.util={},mikan.util.escape=function(a,b){if(void 0==b)var b=!1;try{return b?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):$("<span />").text(val).html()}catch(c){return""}};mikan.html={},mikan.html.bootstrap={},mikan.html.fa={},mikan.html.fa.icon=function(a,b){void 0==b&&(b=null);var c="";return null!=b&&(c=" fa-"+b),'<span class="fa fa-'+a+c+'"> </span>'},mikan.html.bootstrap.icon=function(a){return'<span class="glyphicon glyphicon-'+a+'"> </span>'},mikan.html.bootstrap.rss=function(a,b,c){void 0==c&&(c="fa fa-rss"),mikan.log_debug(a);var d="";for(key in a)item=a[key],d+='<div class="row">',d+='<div class="col-xs-12">',d+=b?'<a href="'+mikan.page.url.wsgi+"/"+item.url+'">':'<a href="'+item.url+'" target="_blank">',d+="<div>",d+='<span class="',d+=c,d+='"> </span> ',d+=item.type,d+='<span class="pull-right text-muted">'+item.date+"</span>",d+="</div>",d+='<div class="text-indent">',d+='<span class="text-muted">&nbsp;&nbsp;</span>',d+=item.title,d+="</div>",d+="</a>",d+="<br />",d+="</div>",d+="</div>";return d},mikan.html.bootstrap.table=function(a,b,c,d,e,f,g,i,j,k){if(void 0==d&&(d=null),void 0==e&&(e=null),void 0==f&&(f=null),void 0==g&&(g="default"),void 0==i&&(i=!1),void 0==j&&(j=null),void 0==k&&(k=null),h='<div class="panel panel-'+g+'">',null!=d&&(h+='<div class="panel-heading">',h+="<h4>",null!=e&&(h+=mikan.html.bootstrap.icon(e)+" "),h+=d,h+="</h4>",h+="</div>"),h+='<table class="table table-striped table-bordered table-hover">',i){h+="<tbody>";for(var l in a)h+="<tr>",h+='<th class="text-right">',h+=b[a[l]],h+="</th>",h+="<td>",h+=c[a[l]]?c[a[l]]:" ",h+="</td>",h+="</tr>";h+="</tbody>"}else{if(b){h+="<thead>",h+="<tr>";for(var l in a){var m=a[l];h+="<th>",h+=b[m],h+="</th>"}h+="</tr>",h+="</thead>"}h+="<tbody>";for(var n in c){var o="",p="";null!=j&&(p=' id="'+j.replace("%d",n)+'"'),null!=k&&(o=' onclick="'+k.replace("%d",n)+'"'),h+="<tr"+p+o+' class="item">';for(var l in a){var m=a[l];h+="<td>",h+=c[n][m]?c[n][m]:" ",h+="</td>"}h+="</tr>"}h+="</tbody>"}return h+="</table>",null!=f&&(h+='<div class="panel-footer">',h+="<p>",h+=f,h+="</p>"),h+="</div>",h},mikan.html.bootstrap.breadcrumbs=function(a){var b='<ol class="breadcrumb">';for(var c in a)b+="<li>",b+="<a",void 0!=a[c].href&&null!=a[c].href&&(b+=' href="',b+=a[c].href,b+='"'),void 0!=a[c].onclick&&null!=a[c].onclick&&(b+=' onclick="',b+=a[c].onclick,b+='"'),b+=">",void 0!=a[c].icon&&null!=a[c].icon&&(b+=mikan.html.bootstrap.icon(a[c].icon),b+=" "),b+=a[c].caption,b+="</a>",b+="</li>";return b+="</ol>"},mikan.html.bootstrap.message=function(a,b,c,d){void 0==c&&(c="default"),void 0==d&&(d=null);var e="",f="panel panel-"+c,g=null;return d&&(g=mikan.html.bootstrap.icon(d)),e+='<div class="'+f+'">',e+='<div class="panel-heading">',e+="<h4>",g&&(e+=g+" "),e+=a,e+="</h4>",e+="</div>",e+='<div class="panel-body">',e+="<h4>",e+=b,e+="</h4>",e+="</div>",e+="</div>"};mikan.css={};mikan.dialog={},mikan.dialog.result=null,mikan.dialog._confirm=function(a,b,c,d,e,f,g,i,j,k,l,m){void 0==a&&(a="mikan_dialog"),void 0==e&&(e="はい"),void 0==f&&(f="いいえ"),void 0==d&&(d=function(){}),void 0==g&&(g="comment"),void 0==i&&(i=""),void 0==j&&(j=null),void 0==m&&(m="");var n=$("#"+a);mikan.dialog.result=null;var o=a+"_modal";h='<div class="modal fade" id="'+o+'" tabindex="-1" role="dialog" aria-hidden="true"',null!=j&&(h+=' data-backdrop="static"'),h+='><div class="modal-dialog '+m+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title '+i+'"><span class="glyphicon glyphicon-'+g+'"></span> '+b+'</h4></div><div class="modal-body">'+c+'</div><div class="modal-footer">',h+=void 0==l?'<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="mikan.dialog.result = true;">'+e+" </button>":'<button type="button" class="btn btn-primary" onclick=" mikan.dialog.result = '+l+"(); if (mikan.dialog.result) $('#"+o+"').modal('hide'); \">"+e+" </button>",""!=f&&(h+='<button type="button" class="btn btn-default" data-dismiss="modal" onclick="mikan.dialog.result = null;">'+f+" </button>"),h+="</div></div></div></div>",0!=n.length?n.html(h):$("body div").first().prepend('<div id="'+a+'">'+h+"</div>"),$("#"+o).on("hidden.bs.modal",d),k&&$("#"+o).css("z-index",k),$("#"+o).parent().css("z-index",k);$("#"+o).modal("show")},mikan.dialog.confirm=function(a,b,c,d,e,f,g,h,i,j){mikan.dialog._confirm("mikan_dialog",a,b,c,d,e,f,"",g,h,i,j)},mikan.dialog.error=function(a,b,c,d,e,f,g,h){id="mikan_error_dialog",void 0==d&&(d=mikan.resource.CLOSE),void 0==c&&(c=function(){}),void 0==g&&(g=9e3),void 0==e&&(e="warning-sign"),mikan.dialog._confirm(id,a,b,c,d,"",e,"text-danger",f,g,h)};mikan.page={},mikan.page.onload=null,mikan.page.onloads={},mikan.page.url={},mikan.page.url.wsgi=MIKAN_WSGI_ROOT,mikan.page.url.js=MIKAN_JS_ROOT,mikan.page.url.image=MIKAN_IMAGE_ROOT,mikan.page.url.htdocs=MIKAN_HTDOCS_ROOT,mikan.page.book={},mikan.page.book.current=null,mikan.page.load=function(){try{mikan.form.tooltip()}catch(a){}mikan.page.onload&&mikan.page.onload();for(var b in mikan.page.onloads)try{mikan.page.onloads[b]()}catch(a){console.log(a)}},mikan.page.unload=function(){},mikan.page.back=function(){history.back()},mikan.page.showbook=function(a){if(null!=mikan.page.book.current)try{$(mikan.page.book.current).addClass("hidden").hide()}catch(b){}else try{$("#summary_jumbotron").addClass("hidden").hide()}catch(b){}null==a?$("#summary_jumbotron").removeClass("hidden").show():$(a).removeClass("hidden").show(),mikan.page.book.current=a;try{mikan.page.setfooterid()}catch(b){}},mikan.page.setfooter=function(){mikan.page.setfooterid("page_footer")},mikan.page.setfooterid=function(a){if(void 0==a)var a="page_footer";var b=$("#"+a);if(b.length)try{b.css("top","0px");var c=document.getElementsByTagName("body")[0].clientHeight,d=document.getElementById(a).offsetTop,e=document.getElementById(a).offsetHeight,f=document.documentElement.clientHeight;mikan.log_debug(c+":"+d+":"+e+":"+f),b.css("position","relative"),f>c?(mikan.log_debug("<"),b.css("top",f-c+"px")):(mikan.log_debug("-"),b.css("top",c-d+"px"))}catch(g){mikan.log_debug(g)}},mikan.page.onloads._footer=function(){function a(a,b,c){try{a.addEventListener(b,c,!1)}catch(d){a.attachEvent("on"+b,c)}}try{var b="page_footer";$("#"+b).length&&(a(window,"load",mikan.page.setfooter),a(window,"resize",mikan.page.setfooter))}catch(c){mikan.log_debug(c)}mikan.page.setfooter()};mikan.form={},mikan.form.html={},mikan.form.items={},mikan.form.event={},mikan.form.consts={},mikan.form.consts.ICON_CHECK="glyphicon-check",mikan.form.consts.ICON_UNCHECKED="glyphicon-unchecked",mikan.form.bootstrap={},mikan.form.bootstrap.builder={},mikan.form.clear_input=function(a){switch(a.type){case"hidden":case"submit":case"reset":case"button":case"image":return;case"file":return;case"text":case"password":case"textarea":return void(a.value="");case"checkbox":case"radio":return void(a.checked=!1);case"select-one":case"select-multiple":return void(a.selectedIndex=0)}},mikan.form.clear=function(a){var a=void 0===a?document.item:a,b=function(){if(mikan.dialog.result)for(var b=0;b<a.elements.length;++b)mikan.form.clear_input(a.elements[b])};mikan.dialog.confirm(mikan.resource.CONFIRM,"入力値を全てクリアしますか？",b)},mikan.form.reset=function(a){var a=void 0===a?document.item:a,b=function(){mikan.dialog.result&&a.reset()};mikan.dialog.confirm(mikan.resource.CONFIRM,"入力値を初期状態にしますか？",b)},mikan.form.submit=function(a){if(void 0===a)try{$("a.btn").addClass("disabled")}catch(b){}var a=void 0===a?document.item:a;a.submit()},mikan.form.tooltip=function(){try{$("button").tooltip()}catch(a){}try{$("a.btn").tooltip()}catch(a){}try{$("span.tooltip").tooltip()}catch(a){}try{$("span.glyphicon-question-sign").tooltip()}catch(a){}},mikan.form.event.select_radio=function(a,b,c){var d=$("#"+b);if(!d.hasClass("active")){var e=$("button."+a);e.removeClass("active"),e.removeClass("btn-primary"),e.addClass("btn-default"),e.removeAttr("checked");var f=$("button."+a+" span."+mikan.form.consts.ICON_CHECK);f.removeClass(mikan.form.consts.ICON_CHECK),f.addClass(mikan.form.consts.ICON_UNCHECKED),d.addClass("active"),d.addClass("btn-primary"),d.attr("checked","true");var g=$("#"+b+" span.glyphicon");g.removeClass(mikan.form.consts.ICON_UNCHECKED),g.addClass(mikan.form.consts.ICON_CHECK),$("#"+a).attr("value",c)}},mikan.form.event.keypress=function(a,b){return 13==b.keyCode?!1:!0},mikan.form.html.input_zipcode=function(a,b,c){var d=(a+"_"+b.name,mikan.form.html.input_text(a,b,c));return c||(d+='<div class="col-xs-2">',d+='<button type="button" class="btn btn-primary" onclick="mikan.form.html.zipcode_to(\''+b.rpc+"','"+a+"', '"+b.name+"', '"+b.zipcode.ken_id+"', '"+b.zipcode.city_name+"');\">住所に変換</button>",d+="</div>"),d},mikan.form.html.zipcode_to=function(a,b,c,d,e){mikan.form.clear_input_error(b,c);var f=$("#"+b+"_"+c)[0];if(f.value){f.value.length>4&&"-"!=f.value[3]&&(f.value=f.value.substring(0,3)+"-"+f.value.substring(3));var g=mikan.json.load(MIKAN_WSGI_ROOT+a+"?c="+f.value,null,!1,null,null,!1,!1);if(mikan.log_debug(g),g){var h=$("#"+b+"_"+d)[0],i=$("#"+b+"_"+e)[0];if(g.ken_id&&g.city_name)return h.value=g.ken_id,void(i.value=g.city_name)}mikan.form.set_input_error(b,c,mikan.resource.form.messages.NOTFOUNTZIPCODE)}},mikan.form.html.input_text=function(a,b,c){var d=a+"_"+b.name,e='<div class="col-xs-'+b.width+'">';if(c)"password"!=b.type?(e+=mikan.form.html.input_hidden(a,b),e+="<p>",e+=mikan.util.escape(b.value,!0),e+="</p>"):e+="<p> </p>";else{var f="form-control";e+='<input type="'+b.type+'" class="'+f+'" name="'+b.name+'" id="'+d+'""',b.maxlength&&(e+=' maxlength="'+b.maxlength+'"'),b.hint&&(e+=' placeholder="'+b.hint+'"'),0==b.edit&&(e+=' disabled="disabled"'),e+=' value="'+b.value+'"',b.required&&(e+=' required="true"'),e+=' onkeypress=" return mikan.form.event.keypress(this, event); " />'}return e+="</div>"},mikan.form.html.input_label=function(){return""},mikan.form.html.input_iframe=function(a,b){return'<iframe class="form_iframe" frameborder="1" src="'+b.value+'" width="75%" height="250px" max-height="300px"> </iframe>'},mikan.form.html.input_select=function(a,b){return mikan.form.html.input_multi(a,b,!1)},mikan.form.html.input_multi=function(a,b,c){if(void 0===c)var c=!0;var d=a+"_"+b.name,e="";e+='<div class="controls col-xs-'+b.width+'">';var f=d+" form-control input-xlarge",g="";0==b.edit&&(f+=" disabled",g=' disabled="disabled"'),c&&(f+=" multiple"),e+='<select id="'+d+'" name="'+b.name+'" class="'+f+'"',void 0!=b.onchange&&(e+=' onchange="'+b.onchange+'"'),e+=g,c&&(e+=' multiple="multiple"'),e+=">";var h=b.value;if(h)try{h=h.split(",")}catch(i){h=[h]}else h=[h];for(var j in b.select)e+='<option value="'+j+'"',-1!=jQuery.inArray(j,h)&&(e+=' selected="True"'),e+=">",e+=b.select[j],e+="</option>";return e+="</select>",e+="</div>"},mikan.form.html.input_radio=function(a,b){var c=a+"_"+b.name,d="";d+='<div class="controls col-xs-'+b.width+'">',d+='<div class="btn-group" data-toggle="buttons">',d+='<input type="hidden" id="'+c+'" name="'+b.name+'" value="'+b.value+'" />';for(var e in b.select){var f=c+" btn",g="",h="",i=mikan.html.bootstrap.icon("unchecked");b.value==e?(f+=" btn-primary active",i=mikan.html.bootstrap.icon("check"),h='checked="true"'):f+=" btn-default",0==b.edit&&(f+=" disabled",g=' disabled="disabled"'),d+='<button name="'+b.name+'" id="'+c+e+'" class="'+f+'" onclick="mikan.form.event.select_radio(\''+c+"','"+c+e+"','"+e+"'); \"",d+=g,d+=' onkeypress=" return mikan.form.event.keypress(this, event); ">',d+=i,d+=" ",d+=b.select[e],d+="</button> "}return d+="</div>",d+="</div>"},mikan.form.html.input_message=function(a,b){var c=(a+"_"+b.name,'<div class="col-xs-'+b.width+'">');return c+="<p>",c+=mikan.util.escape(b.value,!0),c+="</p>"},mikan.form.html.input_checkbox=function(a,b,c){var d=a+"_"+b.name,e="";e+='<div class="controls col-xs-'+b.width+'">';var f="control-label",g="";if(1==b.value&&(g='checked="true"'),!c){var h="";0==b.edit&&(f+=" disabled",h=' disabled="disabled"'),e+='<input class="" type="checkbox" name="'+b.name+'" id="'+d+'" placeholder="" value=" '+b.value+'" '+g+h+" ",void 0!=b.onchange&&(e+=' onchange="'+b.onchange+'"'),0==b.edit&&(h=' disabled="disabled"'),e+=h,e+=" /> "}return e+='<label for="'+d+'" class="'+f+'">',void 0!=b.check&&(e+=b.check),e+="</label> ",e+="</div>"},mikan.form.html.input_textarea=function(a,b,c){var d=a+"_"+b.name,e="";if(e+='<div class="controls col-xs-'+b.width+'">',c)e+=mikan.form.html.input_hidden(a,b),e+="<p>",e+=mikan.util.escape(b.value,!0).replace(/\n/g,"<br />"),e+="</p>";else{var f="",g="";0==b.edit&&(g+=" disabled",f=' readonly="readonly"'),e+="<textarea",e+=' class="'+g+'"',e+=' cols="'+10*b.width+'"',e+=' rows="8"',b.hint&&(e+=' placeholder="'+b.hint+'"'),e+=' id="'+d+'"',e+=' name="'+b.name+'"',e+=f,e+=">",e+=b.value,e+="</textarea>"}return e+="</div>"},mikan.form.html.input_hidden=function(a,b){var c=a+"_"+b.name,d="";return d+='<input type="hidden" name="'+b.name+'" id="'+c+'""',d+=' value="'+b.value+'"',d+=" />"},mikan.form.html.input_file=function(a,b,c){var d=a+"_"+b.name,e="";return c||(e+='<input type="file" name="'+b.name+'" id="'+d+'""',e+=" />"),e},mikan.form.value6select=function(a,b){for(var c in b)if(b[c]==a)return c;return null},mikan.form.html.load_json=function(a,b,c,d){mikan.form.items[c]=mikan.json.load(b,!1);var e=mikan.form.html.create_inputs(c,mikan.form.items[c],d,!1);return a&&($("#"+a).html(e),$("#"+a+"_message").html("")),$("#"+c+"_submit").removeClass("disabled"),e},mikan.form.html.back_json=function(a,b,c,d){if(void 0==d)var d="";var e=mikan.form.html.create_inputs(b,mikan.form.items[b],c,!1);return a&&($("#"+a).html(e),$("#"+a+"_message").html(d)),$("#"+b+"_submit").removeClass("hidden"),$("#"+b+"_back").addClass("hidden"),$("html,body").animate({scrollTop:0},"fast"),e},mikan.form.confirm_json=function(a,b,c,d,e){if(void 0==e)var e=!0;if(void 0==c)var c="";if($("html,body").animate({scrollTop:0},"fast"),$("#"+b+"_back").hasClass("hidden"))if(null==mikan.form.validate_json(b,d)){if(e){$("#"+b+"_back").removeClass("hidden"),mikan.form.items[b]=mikan.form.value6form(b,mikan.form.items[b],d);var f=mikan.form.html.create_inputs(b,mikan.form.items[b],d,!0);return a&&($("#"+a).html(f),$("#"+a+"_message").html(mikan.html.bootstrap.message(mikan.resource.CONFIRM,"以下の内容でよろしいでしょうか？以下の内容で続ける場合実行を選択してください。","success","user"))),f}mikan.form.items[b]=mikan.form.value6form(b,mikan.form.items[b],d)}else if(a)return void $("#"+a+"_message").html(mikan.html.bootstrap.message(mikan.resource.ERROR,"入力内容を御確認ください。","danger","user"));$("#"+a+"_message").html(mikan.html.bootstrap.message(mikan.resource.PROCESS,'<img src="'+MIKAN_IMAGE_ROOT+'loading.gif" alt="'+mikan.resource.LOADING+'" />'+mikan.resource.PROCESSING,"info","repeat")),$("#"+b+"_submit").addClass("hidden"),$("#"+b+"_back").addClass("hidden");var g=new FormData;for(var h in mikan.form.items[b]){var i=mikan.form.items[b][h];if(MIKAN_DEBUG_ON===!0&&(console.log(i.name),console.log(i.value)),"file"!=i.type)g.append(i.name,i.value);else{var j=$("#"+b+"_"+i.name);MIKAN_DEBUG_ON===!0&&(mikan.log_debug(j),mikan.log_debug(j[0])),g.append(i.name,j[0].files[0])}}return done=function(c){MIKAN_DEBUG_ON===!0&&mikan.log_debug(c);var e=null,f="",g=mikan.resource.message.DONE;if(c)if(c instanceof Error)try{e=e.message}catch(h){}else{if(void 0!==c.responseText)try{{c.responseText}try{e=mikan.util.escape(c.responseText,!0)}catch(h){mikan.log_error(h),mikan.log_debug(c.responseText),e=mikan.resource.ERRORl}}catch(h){}if(null==e)try{0==c.status?c.message&&(g=c.message):e=c.message}catch(h){mikan.log_error(h),e=h.message}}else e=mikan.resource.ERROR;if(e)f=mikan.html.bootstrap.message(mikan.resource.ERROR,e,"danger","warning-sign"),mikan.form.html.back_json(a,b,d,f);else{var i=mikan.form.html.create_inputs(b,mikan.form.items[b],d,!0);$("#"+a).html(i),g=mikan.html.bootstrap.message(mikan.resource.DONE,g,"info","saved"),$("#"+a+"_message").html(g),mikan.form.items[b]=null}},MIKAN_DEBUG_ON===!0&&console.log(c),mikan.json.post(c,g,!0,done,done,!1,!0),null},mikan.form.validate_json=function(a,b){return mikan.form.validate(a,mikan.form.items[a],b)},mikan.form.html.confirm_inputs=function(a,b,c){return mikan.form.html.create_inputs(a,b,c,!0)},mikan.form.html.create_inputs=function(a,b,c,d,e){if(void 0==d)var d=!1;if(void 0==e)var e=mikan.resource.REQUIRED;var f=b;try{void 0!=b.items&&(f=b.items)}catch(g){}try{f.sort(function(a,b){try{var c=a.sort,d=b.sort;return void 0==c?0:void 0==d?0:d>c?-1:c>d?1:0}catch(e){return 0}})}catch(g){}var h="";h+='<div class="row">';var i=!1;for(var j in f){var k=f[j],l=a+"_"+k.name;if(!d||"iframe"!=k.type){if("hidden"!=k.type){0!=k.formgroup&&(i&&(h+="</div>"),h+='<div class="form-group">',i=!0);var m=3;void 0!=k.label&&(m=k.label);var n=l+" control-label col-xs-"+m;void 0!=k.offset&&(n+=" col-xs-offset-"+k.offset),1==k.nolabel&&(n+=" sr-only"),h+='<label for="'+l+'" class="text-right '+n+'">',h+=k.caption,k.required&&!d&&0!=k.edit&&(h+=" "+e),h+="</label>"}"text"==k.type||"number"==k.type||"password"==k.type||"datetime"==k.type||"datetime-local"==k.type||"date"==k.type||"month"==k.type||"time"==k.type||"week"==k.type||"email"==k.type||"url"==k.type||"search"==k.type||"tel"==k.type||"color"==k.type?h+=mikan.form.html.input_text(a,k,d):"zipcode"==k.type?h+=mikan.form.html.input_zipcode(a,k,d):"label"==k.type?h+=mikan.form.html.input_label(a,k,d):"select"==k.type?h+=mikan.form.html.input_select(a,k,d):"multi"==k.type?h+=mikan.form.html.input_multi(a,k,!0,d):"hidden"==k.type?h+=mikan.form.html.input_hidden(a,k,d):"radio"==k.type?h+=mikan.form.html.input_radio(a,k,d):"checkbox"==k.type?h+=mikan.form.html.input_checkbox(a,k,d):"message"==k.type?h+=mikan.form.html.input_message(a,k,d):"textarea"==k.type?h+=mikan.form.html.input_textarea(a,k,d):"iframe"==k.type?h+=mikan.form.html.input_iframe(a,k,d):"file"==k.type?h+=mikan.form.html.input_file(a,k,d):void 0!=c&&(h+=c(a,k,d))}}return i&&(h+="</div>"),h+="</div>"},mikan.form.value=function(a,b,c){var d=$("#"+a+"_"+b.name);return"text"==b.type||"number"==b.type||"password"==b.type||"datetime"==b.type||"datetime-local"==b.type||"date"==b.type||"month"==b.type||"time"==b.type||"week"==b.type||"email"==b.type||"url"==b.type||"search"==b.type||"tel"==b.type||"color"==b.type||"zipcode"==b.type?d[0].value:"select"==b.type||"multi"==b.type?d[0].value:"number"==b.type?d[0].value:"radio"==b.type?d[0].value:"checkbox"==b.type?1==d[0].checked:"textarea"==b.type?d[0].value:"hidden"==b.type?d[0].value:"file"==b.type?d[0].value:"iframe"==b.type?"":"message"==b.type?null:void 0!=c?c(a,b):null},mikan.form.set_input_error=function(a,b,c){var d=mikan.form.get_input_label(a,b);for(var e in d)null!=d[e]&&d[e].addClass("has-error");if(c)try{d.input.parent().append('<span class="help-block">'+mikan.html.bootstrap.icon("hand-up")+" "+c+"</span>")}catch(f){}},mikan.form.get_input_label=function(a,b){var c=b;b&&b.name&&(c=b.name);var d=$("label."+a+"_"+c),e=$("#"+a+"_"+c),f=e.parent(""),g=null;return{label:d,input:e,group:f,other:g}},mikan.form.clear_input_error=function(a,b){var c=mikan.form.get_input_label(a,b);for(var d in c)c[d]&&c[d].removeClass("has-error");try{c.input.parent().children("span.help-block").remove()}catch(e){}},mikan.form.value6form=function(a,b,c){var d=b;try{void 0!=b.items&&(d=b.items)}catch(e){}for(var f in d){var g=d[f];if("iframe"!==g.type){var h=mikan.form.value(a,g,c);d[f].value=h}}return d},mikan.form.validate=function(a,b,c,d){if(void 0==d)var d=mikan.resource.form.messages;var e={},f=b;try{void 0!=b.items&&(f=b.items)}catch(g){}for(var h in f){var i=f[h];mikan.form.clear_input_error(a,i);var j=mikan.form.value(a,i,c);mikan.form.validate_input(a,i,d,e,j,f,c)}for(var h in e)return e;return null},mikan.form.get_item=function(a,b){for(var c in a){var d=a[c];if(d.name==b)return d}return null},mikan.form.validate_input=function(a,b,c,d,e,f,g){if(void 0==c)var c=mikan.resource.form.messages;input=$("#"+a+"_"+b.name);var h=jQuery.trim(e);if(input.attr("disabled"));else{var i=h?!0:!1;if(0===e&&(i=!0),e===!1&&(i=!1),void 0===e&&(i=!1),i){if(b.reg){var j=b.reg;if(e.match(j));else{var k=void 0===c.REG?c.reg:c.REG;d[b.name]={},d[b.name].type="error",d[b.name].category="reg",d[b.name].mesasge=k,mikan.form.set_input_error(a,b,k)}}if(b.number){var j="^-*[0-9]*$";"float"==b.number.type&&(j+=".[0-9]*");{var l=new RegExp(j);l.exec(e)}if(e.match(j)&&e>=b.number.min&&e<=b.number.max);else{var k=void 0===c.NUMBER?c.number:c.NUMBER;d[b.name]={},d[b.name].type="error",d[b.name].category="number",d[b.name].mesasge=k,mikan.form.set_input_error(a,b,k)}}if(b.match){var m=mikan.form.get_item(f,b.match),n=mikan.form.value(a,m,g);if(mikan.log_debug(m),mikan.log_debug(e),mikan.log_debug(n),n!=e){var k=void 0===c.MATCH?c.match:c.MATCH;k=k,d[b.name]={},d[b.name].type="error",d[b.name].category="number",d[b.name].mesasge=k,mikan.form.set_input_error(a,m,b.caption+" "+k),mikan.form.set_input_error(a,b,m.caption+" "+k)}}}else if(b.required){var k=void 0===c.REQUIRED?c.required:c.REQUIRED;d[b.name]={},d[b.name].type="error",d[b.name].category="required",d[b.name].mesasge=k,mikan.form.set_input_error(a,b,k)}}},mikan.form.bootstrap.builder.init=function(){for(var a=$("#mikan_bb_data"),b=["true","false"],c=["text","password","datetime","datetime-local","date","month","time","week","number","email","url","search","tel","color","checkbox","radio","select","textarea","label","hidden","iframe","file","message","zipcode"],d=[],e=[];t=c.shift();)e.push([[t]]);for(;t=b.shift();)d.push([[t]]);var f=["定義名","表示名","表示","必須","編集","タイプ","ラベル幅","ラベルなし","幅","位置","選択肢","改行","初期値","入力規則","ヒント"],g=[["f1","テスト1","","","false","text","","","","","","true","入力値","","ヒント"],["f2","テスト2","","true","","text","","","","","","false","入力値","","ヒント"],["f3","テスト3","test","","","checkbox","","","","","","","","",""],["f4","テスト4","","","","radio","","","","","test:a,aaa:b,eee:row,p:p","","test","",""],["f5","テスト5","","","","select","","","","","test:a,aaa:b,eee:row,p:p","","aaa","",""],["f6","テスト6","","","","multi","","","","","test:a,aaa:b,eee:row,p:p","false","aaa","",""],["f7","テスト7","","","","textarea","","","6","","","","","","ヒント"],["f8","テスト8","","","","label","","","3","","","","","",""],["f9","テスト9","","true","","number","","","2","","","","1","","ヒント"],["f10","テスト10","","","","password","","","","","","false","1","","ヒント"],["f11","テスト11","","","","date","","","","","","","1","","ヒント"],["f12","テスト12","","","","hidden","","","","","","","1","",""],["f13","テスト13","","","","tel","","","","","","","1","^0[0-9]{1,3}-{1}[0-9]{2,4}-{1}[0-9]{4}$",""],["f14","テスト14","","","","email","","","","","","","1","^.*@.*[.].*$",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]];mikan.form.bootstrap.builder.items=g;a.html(""),a.handsontable({data:g,colHeaders:f,columns:[{},{},{},{type:"handsontable",handsontable:{colHeaders:!1,data:d}},{type:"handsontable",handsontable:{colHeaders:!1,data:d}},{type:"handsontable",handsontable:{colHeaders:!1,data:e}},{},{type:"handsontable",handsontable:{colHeaders:!1,data:d}},{},{},{},{type:"handsontable",handsontable:{colHeaders:!1,data:d}},{},{},{}],afterChange:function(){mikan.form.bootstrap.builder.apply()}}),mikan.form.bootstrap.builder.apply()},mikan.form.bootstrap.builder.row_add=function(){},mikan.form.bootstrap.builder.apply=function(){var a=mikan.form.bootstrap.builder.items,b=[];for(var c in a){var d=a[c];if(d[0]){var e={name:d[0],caption:d[1],type:d[5],value:d[12]};if(d[2]&&(e.check=d[2]),d[3]&&"true"==d[3]&&(e.required=!0),d[4]&&(e.edit=0==d[4]),e.label=d[6]?d[6]:2,d[7]&&"true"==d[7]&&(e.nolabel=!0),e.width=d[8]?d[8]:4,d[9]&&(e.offset=d[9]),d[10]){var f={},g=d[10].split(",");for(var h in g)try{var i=g[h].split(":");f[i[0]]=i[1]}catch(j){}e.select=f}d[11]&&"false"==d[11]&&(e.formgroup=!1),d[13]&&(e.reg=d[13]),d[14]&&(e.hint=d[14]),"zipcode"==d[5]&&(e.zipcode={},e.zipcode.ken_id="prefecture",e.zipcode.city_name="address1");var k=c;10>c&&(k="0"+c),e.sort=parseInt(c),b.push(e)}}var l=$("#mikan_bb_json");l.html("<pre><code>"+JSON.stringify({items:b},null,"	")+"</code></pre>");var m='<form class="form-horizontal" role="form" onsubmit=" return false; ">';m+=mikan.form.html.create_inputs("mikan",{items:b}),m+="</form>",$("#mikan_bb_preview").html(m),$("#mikan_bb_html").text(m.toString()),$(".multiple").multiselect({includeSelectAllOption:!0,enableCaseInsensitiveFiltering:!0})};mikan.json={},mikan.json.response=function(a,b){var c=a.responseText;return mikan.log_debug(c),c?(b&&(c=mikan.util.escape(c,!0)),$.parseJSON(c)):c},mikan.json.ajax=function(a,b,c,d,e,f,g,h){if(void 0==d)var d=!1;if(void 0==g)var g=!0;if(void 0==h)var h=!1;try{var i={type:b,scriptCharset:"utf-8",url:a,dataType:"json",async:d};mikan.log_debug(i),h&&(i.contentType=!1,i.processData=!1),c&&(i.data=c),e&&(i.success=e),f&&(i.error=f);var j=$.ajax(i);return d?j:mikan.json.response(j,g)}catch(k){f&&f(k)}return null},mikan.json.load=function(a,b,c,d,e,f,g){return mikan.json.ajax(a,"GET",b,c,d,e,f,g)},mikan.json.post=function(a,b,c,d,e,f,g){return mikan.json.ajax(a,"POST",b,c,d,e,f,g)},mikan.json.list=function(a,b){try{var c=mikan.json.load(b,null,!1,null,null),d="";return c&&(d=mikan.html.bootstrap.rss(c.items,!1)),$(a).html(d),c}catch(e){mikan.log_debug(e),$(a).html(e)}return null},mikan.json.table=function(a,b,c,d,e,f,g,h,i,j){try{var k=mikan.json.load(b,null,!1,null,null,!1,null),l=mikan.html.bootstrap.table(k.keys,k.columns,k.items,d,e,f,g,h,i,j);return $("#"+a).html(l),k}catch(m){mikan.log_debug(m),$("#"+a).html("")}return null};mikan.tree={},mikan.tree.id={},mikan.tree.url={},mikan.tree.thumbnails={},mikan.tree.url.tree="./tree",mikan.tree.url.list="./list?id=",mikan.tree.id.tree="#mikan_tree",mikan.tree.id.title="#mikan_title h4",mikan.tree.id.list="#mikan_list",mikan.tree.thumbnails.list=!1,mikan.tree.onselected=function(a,b){var c,d=[];for(c=0,d=b.selected.length;d>c;c++)return n=b.instance.get_node(b.selected[c]),void mikan.tree.thumbnail(n.text,n.id)},mikan.tree.onselectitem=function(a,b){var c,d=[];for(c=0,d=b.selected.length;d>c;c++)return n=b.instance.get_node(b.selected[c]),void mikan.tree.item(n.text,n.id)},mikan.tree.init=function(){$(mikan.tree.id.tree).on("changed.jstree",mikan.tree.onselected).jstree({core:{animation:0,check_callback:!0,themes:{stripes:!0},data:{url:function(){return mikan.tree.url.tree},data:function(){return{}}}},types:{"#":{max_children:1,max_depth:4,valid_children:["root"]},file:{icon:"glyphicon glyphicon-file",valid_children:[]}},plugins:["state","types"]})},mikan.tree.thumbnail=function(b,c,e){void 0==e&&(e=!1),$(mikan.tree.id.title).html(b),$(mikan.tree.id.list).html('<img src="'+MIKAN_IMAGE_ROOT+'loading.gif" alt="'+mikan.resource.LOADING+'" />'+mikan.resource.LOADING);var f=mikan.json.load(mikan.tree.url.list+c),g="";if(f){base_url=f.url,mikan.tree.thumbnails.list&&(g+='<ul class="media-list">');for(name in f.nodes)a=f.nodes[name],name=a.file,size=a.size,d=a.time,thumbnail=base_url+"/thumbnail/"+name,path=base_url+"/"+name,mikan.tree.thumbnails.list?(g=g+'<li class="media"><a class="pull-left" href="'+path+'" title="'+name+'" target="image" class="colorbox1 thumbnail"><img class="media-object" src="'+thumbnail+'" alt="'+name+'" /></a>',g+='<div class="media-body">',g=g+'<h4 class="media-heading">'+name+"</h4>",g=g+"<p>"+d+" "+size+"</p>",g+="</div>"):g=g+'<div class="col-xs-2 col-md-2"><a href="'+path+'" title="'+name+'" target="image" class="colorbox1 thumbnail"><img src="'+thumbnail+'" alt="'+name+'" /></a></div>';mikan.tree.thumbnails.list&&(g+="</ul>")}$(mikan.tree.id.list).html(g),$(".colorbox1").colorbox({rel:"colorbox1",transition:"none",width:"90%",height:"90%"})},mikan.tree.item=function(a,b){$(mikan.tree.id.title).html(a);var c='<a href="./'+b+'/" title="'+a+'">'+a+"管理画面へ</a>";$(mikan.tree.id.list).html(c)};mikan.admin={},mikan.admin.table={},mikan.admin.table.url={},mikan.admin.table.id=null,mikan.admin.table.items={},mikan.admin.table.selected={},mikan.admin.table.refresh=function(a){$(a).hasClass("disabled")||(mikan.admin.table.items={},mikan.admin.table.selected={},$("#"+mikan.admin.table.id).html('<img src="'+MIKAN_IMAGE_ROOT+'/loading.gif" alt="" />'),mikan.admin.table.items=mikan.json.table(mikan.admin.table.id,MIKAN_WSGI_ROOT+mikan.admin.table.url.table,null,"tests","book",null,"default",!1,"item_%d","mikan.admin.table.item_select('%d');"),$("#"+mikan.admin.table.id+" div table").tablesorter({cssAsc:"warning",cssDesc:"danger"}),mikan.admin.table.button_status())},mikan.admin.table.select_all=function(a){if(!$(a).hasClass("disabled")){mikan.admin.table.selected={};for(var b in mikan.admin.table.items.items)mikan.admin.table.selected[b]="i"+b;$("#"+mikan.admin.table.id+" table tbody tr.item").addClass("warning"),mikan.admin.table.button_status()}},mikan.admin.table.unselect_all=function(){mikan.admin.table.selected={},$("#"+mikan.admin.table.id+" table tbody tr.item").removeClass("warning"),mikan.admin.table.button_status()},mikan.admin.table.item_select=function(a){var b=!1;try{b=mikan.admin.table.selected[a],void 0==b&&(b=!1),0!=b&&delete mikan.admin.table.selected[a]}catch(c){}0==b&&(mikan.admin.table.selected[a]="i"+a),0!=b?$("tr#item_"+a).removeClass("warning"):$("tr#item_"+a).addClass("warning"),mikan.admin.table.button_status()},mikan.admin.table.button_status=function(){var a=!1,b=!1;for(var c in mikan.admin.table.selected){if(a){a=!1,b=!0;break}a=!0}a||b?$(".item-select").removeClass("disabled"):$(".item-select").addClass("disabled"),a?$(".item-select-single").removeClass("disabled"):$(".item-select-single").addClass("disabled"),b?$(".item-select-multi").removeClass("disabled"):$(".item-select-multi").addClass("disabled")},mikan.admin.table.search=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))},mikan.admin.table.item_property=function(a){if(!$(a).hasClass("disabled")){var b=null;for(var c in mikan.admin.table.selected){b=mikan.admin.table.items.items[c];break}var d=mikan.json.load(MIKAN_WSGI_ROOT+mikan.admin.table.url.item_property+"&d="+b.id,null,!1,null,null,!1,null),e=mikan.html.bootstrap.table(d.keys,d.columns,d.items[0],null,null,null,"info",!0,null,null);mikan.dialog.confirm("プロパティ",e,function(){},"閉じる","","file","static",3e3,null,"modal-lg")}},mikan.admin.table.mail=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))},mikan.admin.table.item_create=function(a){if(!$(a).hasClass("disabled")){var b=mikan.json.load(MIKAN_WSGI_ROOT+mikan.admin.table.url.item_create,null,!1,null,null,!1,null),c=mikan.form.html.create_inputs("item",b.items,null,!1),d="";d+='<div class="row">',d+='<div class="col-xs-10">',d+='<form class="form-horizontal" role="form" enctype="multipart/form-data" onsubmit=" return false; " name="json_form">',d+='<div class="row">',d+='<div class="col-xs-offset-1 col-xs-11" id="form_message"> </div>',d+='<div class="col-xs-offset-0 col-xs-12">',d+='<div id="form">'+c+"</div>",d+="</div>",d+="</div>",d+="</form>",d+="</div>",d+="</div>",mikan.dialog.confirm("新規作成",d,function(){},"作成","キャンセル","file","static",3e3,null,"modal-lg")}},mikan.admin.table.item_update=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))},mikan.admin.table.item_remove=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))},mikan.admin.table.item_copy=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))},mikan.admin.table.file_export=function(a){$(a).hasClass("disabled")||(console.trace(),mikan.dialog.error("開発中","まだ未実装です。"))};